// -----------------------------------------------------
// CONFIGURAÇÕES PRISMA
// -----------------------------------------------------

generator client {
  provider = "prisma-client-js"
  output   = "./generated"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
} 

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// -----------------------------------------------------
// ENUMS
// -----------------------------------------------------

// Status atual do carro disponível para viagens
enum StatusCarro {
  DISPONIVEL
  EM_USO        
  EM_MANUTENCAO
} 

// Classificação dos veículos
enum TipoCarro {
  VAN
  MINIVAN
  HATCH
  SEDAN
  SUV
} 

// Categorias de mensagens enviadas via ouvidoria
enum CategoriaMensagemOuvidoria {
  DENUNCIA
  SOLICITACAO
  SUGESTAO
  RECLAMACAO
  ELOGIO
} 

// Status de uma solicitação de viagem
enum StatusSolicitacaoViagem {
  PENDENTE
  CONFIRMADA
  REALIZADA
  CANCELADA
}

// Tipo geral de solicitação
enum TipoSolicitacao {
  VIAGEM
  OUVIDORIA
  CONSULTA
}

// Categoria das notícias do portal

enum CategoriaNoticia {
  SAUDE 
  EDUCACAO 
  INFRAESTRUTURA // 1
  CULTURA // 3
  ESPORTE // 3
  ADMINISTRACAO_PUBLICA     // 2
  DESENVOLVIMENTO_ECONOMICO
  SERVICOS // 1
  OBRAS // 1
  TRANSPORTE // 1
  ASSISTENCIA_SOCIAL       
  SEGURANCA
  HABITACAO // 1
  ECONOMIA // 2
  EMPREGOS // 2
  LICITACOES // 2
  EVENTOS // 3
  TURISMO // 3
  MEIO_AMBIENTE            
}


// -----------------------------------------------------
// USUÁRIO, FUNCIONÁRIO E FUNÇÕES
// -----------------------------------------------------

// Usuário geral do sistema (pacientes, cidadãos, funcionários)
model Usuario {
  idUsuario          String           @id @default(uuid())
  primeiroNome       String
  sobrenome          String
  cpf                String        @unique @db.Char(11)
  telefone           String        @db.Char(11)
  email              String        @unique
  senha              String
  endereco           String
  telefoneConfirmado Boolean       @default(false)
  emailConfirmado    Boolean       @default(false)
  createdAt          DateTime      @db.Date
  AcompanhantePaciente AcompanhantePaciente[]

  Funcionario Funcionario[]
  Solicitacao Solicitacao[]
  
}

// Funcionário (ex.: motorista, administrativo etc.)
model Funcionario {
  idFuncionario     String                 @id @default(uuid())
  Usuario_idUsuario String
  pis               Int?
  matricula         Int?

  Usuario           Usuario             @relation(fields: [Usuario_idUsuario], references: [idUsuario], onDelete: Cascade)
  FuncionarioFuncao FuncionarioFuncao[]
  Viagem            Viagem[]

  @@index([Usuario_idUsuario])
} 

// Funções atribuídas aos funcionários
model Funcao {
  idFuncao          String                 @id @default(uuid())
  nome              String
  FuncionarioFuncao FuncionarioFuncao[]
}

// Tabela pivot Funcionario <-> Função
model FuncionarioFuncao {
  Funcionario_idFuncionario String
  Funcao_idFuncao           String

  Funcao      Funcao      @relation(fields: [Funcao_idFuncao], references: [idFuncao], onDelete: Cascade)
  Funcionario Funcionario @relation(fields: [Funcionario_idFuncionario], references: [idFuncionario], onDelete: Cascade)

  @@id([Funcionario_idFuncionario, Funcao_idFuncao])
  @@index([Funcao_idFuncao])
}

// -----------------------------------------------------
// SOLICITAÇÕES (SUPER-ENTIDADE)
// -----------------------------------------------------

// Solicitação genérica (pode ser viagem, consulta, ouvidoria...)
model Solicitacao {
  idSolicitacao             String                 @id @default(uuid())
  Usuario_idUsuario         String
  primeiro_nome_solicitante String
  sobrenome_solicitante     String
  email_solicitante         String
  telefone_solicitante      String
  TipoSolicitacao           TipoSolicitacao

  Usuario           Usuario             @relation(fields: [Usuario_idUsuario], references: [idUsuario], onDelete: Cascade)
  MensagemOuvidoria MensagemOuvidoria[]
  PedidoConsulta    PedidoConsulta[]
  SolicitacaoViagem SolicitacaoViagem[]

  @@index([Usuario_idUsuario])
}

// -----------------------------------------------------
// OUVIDORIA
// -----------------------------------------------------

model MensagemOuvidoria {
  idMensagemOuvidoria        String                        @id @default(uuid())
  Solicitacao_idSolicitacao  String
  assunto                    String
  mensagem                   String
  nomeSolicitante            String?
  emailSolicitante           String?
  numeroProtocolo            String?                    @db.Char(15)
  status                     String?
  CategoriaMensagemOuvidoria CategoriaMensagemOuvidoria

  Solicitacao                Solicitacao @relation(fields: [Solicitacao_idSolicitacao], references: [idSolicitacao], onDelete: Cascade)

  @@index([Solicitacao_idSolicitacao])
}

// -----------------------------------------------------
// CONSULTAS / UBS
// -----------------------------------------------------

model UnidadeUbs {
  idUnidadeUbs            String                       @id @default(uuid())
  nome_unidade            String
  endereco_unidade        String

  EspecialidadeUnidadeUbs EspecialidadeUnidadeUbs[]
  PedidoConsulta          PedidoConsulta[]
} 

model Especialidade {
  idEspecialidade         String                       @id @default(uuid())
  nome_especialidade      String
  EspecialidadeUnidadeUbs EspecialidadeUnidadeUbs[]
} 

// Pivot Especialidade <-> Unidade UBS
model EspecialidadeUnidadeUbs {
  Especialidade_idEspecialidade String
  UnidadeUbs_idUnidadeUbs       String

  Especialidade Especialidade @relation(fields: [Especialidade_idEspecialidade], references: [idEspecialidade], onDelete: Cascade)
  UnidadeUbs    UnidadeUbs    @relation(fields: [UnidadeUbs_idUnidadeUbs], references: [idUnidadeUbs], onDelete: Cascade)

  @@id([Especialidade_idEspecialidade, UnidadeUbs_idUnidadeUbs])
  @@index([UnidadeUbs_idUnidadeUbs])
} 

model PedidoConsulta {
  idPedidoConsulta          String         @id @default(uuid())
  UnidadeUbs_idUnidadeUbs   String
  Solicitacao_idSolicitacao String

  Solicitacao Solicitacao @relation(fields: [Solicitacao_idSolicitacao], references: [idSolicitacao], onDelete: Cascade)
  UnidadeUbs  UnidadeUbs  @relation(fields: [UnidadeUbs_idUnidadeUbs], references: [idUnidadeUbs])

  @@index([Solicitacao_idSolicitacao])
  @@index([UnidadeUbs_idUnidadeUbs])
}

// -----------------------------------------------------
// VIAGENS
// -----------------------------------------------------

// Pessoa que acompanha o paciente
model Acompanhante {
  idAcompanhante    String                 @id @default(uuid())
  nomeCompleto      String
  endereco          String
  telefone          String              @db.Char(11)
  email             String
  cpf               String              @db.Char(11)

  AcompanhantePaciente AcompanhantePaciente[]
  SolicitacaoViagem SolicitacaoViagem[]
}

// Relação entre acompanhante e paciente (usuário)

model AcompanhantePaciente {
  Acompanhante_idAcompanhante String
  Usuario_idUsuario           String

  Acompanhante Acompanhante @relation(fields: [Acompanhante_idAcompanhante], references: [idAcompanhante], onDelete: Cascade)
  Usuario      Usuario      @relation(fields: [Usuario_idUsuario], references: [idUsuario], onDelete: Cascade)

  @@id([Acompanhante_idAcompanhante, Usuario_idUsuario])
  @@index([Usuario_idUsuario])
}

// Solicitações de viagem (subtipo de Solicitação)
model SolicitacaoViagem {     
  idSolicitacaoViagem         String                     @id @default(uuid())
  Solicitacao_idSolicitacao   String
  Acompanhante_idAcompanhante String?
  Viagem_idViagem             String?
  endereco_paciente           String
  local_consulta              String
  cidade_consulta             String
  comprovante_url             String?
  data_consulta               DateTime @db.Date
  horario_consulta            DateTime @db.Time(0)
  motivo_cancelamento         String? 
  
  StatusSolicitacao StatusSolicitacaoViagem @default(PENDENTE)
  Acompanhante  Acompanhante? @relation(fields: [Acompanhante_idAcompanhante], references: [idAcompanhante])
  Solicitacao   Solicitacao   @relation(fields: [Solicitacao_idSolicitacao], references: [idSolicitacao], onDelete: Cascade)
  Viagem        Viagem?       @relation(fields: [Viagem_idViagem], references: [idViagem])

  @@index([Acompanhante_idAcompanhante])
  @@index([Solicitacao_idSolicitacao])
  @@index([Viagem_idViagem])
}

// Viagem (quando uma solicitação vira um transporte real)
model Viagem {
  idViagem                  String                 @id @default(uuid())
  Funcionario_idFuncionario String
  Carro_idCarro             String
  dataPartida               DateTime               @db.Date
  horaPartida               DateTime               @db.Time(0)
  enderecoLocalPartida      String
  
  SolicitacaoViagem SolicitacaoViagem[]
  Carro             Carro      @relation(fields: [Carro_idCarro], references: [idCarro])
  Funcionario       Funcionario @relation(fields: [Funcionario_idFuncionario], references: [idFuncionario], onDelete: Cascade)

  @@index([Carro_idCarro])
  @@index([Funcionario_idFuncionario])
}

// // Pontos de parada de uma viagem (REMOVER)
// model Parada {
//   idParada                              String @id @default(uuid())
//   SolicitacaoViagem_idSolicitacaoViagem Int
//   Viagem_idViagem                       Int
//   endereco String
  
//   SolicitacaoViagem SolicitacaoViagem @relation(fields: [SolicitacaoViagem_idSolicitacaoViagem], references: [idSolicitacaoViagem], onDelete: Cascade)
//   Viagem            Viagem            @relation(fields: [Viagem_idViagem], references: [idViagem])

//   @@index([SolicitacaoViagem_idSolicitacaoViagem])
//   @@index([Viagem_idViagem])
// }

// Informações sobre os carros
model Carro {
  idCarro     String       @id @default(uuid())
  modelo      String
  marca       String
  cor         String
  placa       String      @db.Char(7)
  capacidade  Int
  
  StatusCarro StatusCarro @default(DISPONIVEL)
  TipoCarro   TipoCarro
  Viagem      Viagem[]
}

// -----------------------------------------------------
// CURSOS E EVENTOS
// -----------------------------------------------------

model Curso {
  idCurso        String      @id @default(uuid())
  titulo         String
  descricao      String
  imagem_capa    String
  link_inscricao String
  criado_em      DateTime     @db.Date
  ativo          Boolean      @default(true)
  IntervaloDatas String
}

model Evento {
  idEvento          String      @id @default(uuid())
  titulo            String
  descricao         String      @db.LongText
  local_evento      String
  imagem_chamada    String
  imagem_capa       String
  criado_em         DateTime     @db.Date 
  ativo             Boolean      @default(true)
  mesInicio         Int
  anoInicio         Int
  IntervaloDatas    String
}

// -----------------------------------------------------
// TAXISTAS (REMOVER)
// -----------------------------------------------------

// -----------------------------------------------------
// NOTÍCIAS
// -----------------------------------------------------

model Noticia {
  idNoticia String              @id @default(uuid())
  titulo    String              
  corpo     String              @db.LongText
  imagemUrl String
  autor     String
  publicadaEm DateTime          @db.Date

  categoria CategoriaNoticia
}
